<% include ../partials/header.ejs %>

<div class="mainWrapper">
    <div class="post">
        <div class="showPost">
            <img src="<%= post.image %>" alt="" id="displayPost">
        </div>
        <div class="showOther">

            <div>
                <p style="margin: 2px 0;"><%= post.author.username %></p>
                <p style="margin: 2px 0;"><%= post.caption %></p>
            </div>

            <% if(currentUser && currentUser._id.equals(post.author.id)){ %>
            <form action="/<%= user._id %>/post/<%= post._id %>?_method=DELETE" method="POST">
                <a href="/<%= user._id %>/post/<%= post._id %>/edit" class="btn btn-info">Edit</a>
                <button class="btn btn-danger">Delete</button>
            </form>
            <% } %>


            <%  if(isPostLiked === -1){ %>
            <form action="/<%= user._id %>/post/<%= post._id %>/like" method="POST" id="likeBtn">
                <button class="btn btn-secondary">Like</button>
                <a href="/<%= user._id %>/post/<%= post._id %>/comment/new" class="btn btn-primary">Add Comment</a>
            </form>
            <% } else { %>
            <form action="/<%= user._id %>/post/<%= post._id %>/unlike" method="POST" id="unlikeBtn">
                <button class="btn btn-secondary">Unlike</button>
                <a href="/<%= user._id %>/post/<%= post._id %>/comment/new" class="btn btn-primary">Add Comment</a>
            </form>
            <% } %>

            <hr style="margin: 2px 0;">

            <% post.comments.forEach(function(comment){ %>
            <p style="margin-bottom: 2px;"><strong><%= comment.author.username %></strong></p>
            <p style="margin-bottom: 2px;"><%= comment.text %></p>
            <% if(currentUser && currentUser._id.equals(comment.author.id)){ %>
            <form action="/<%= user._id %>/post/<%= post._id %>/comment/<%= comment._id %>/delete?_method=DELETE"
                method="POST" class="">
                <a href="/<%= user._id %>/post/<%= post._id %>/comment/<%= comment._id %>/edit"
                    class="btn btn-info btn-sm">Edit Comment</a>
                <button class="btn btn-danger btn-sm">Delete</button>
            </form>
            <% } %>
            <%}) %>
        </div>

    </div>
</div>

<% include ../partials/footer.ejs %>